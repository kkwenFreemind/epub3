<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>電子書閱讀器</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://unpkg.com/epubjs@0.3.96/dist/epub.min.js"></script>
  <style>
    #book-list { margin-bottom: 20px; }
    #reader { width: 100%; height: 80vh; border: 1px solid #ccc; }
    button { margin: 5px; padding: 10px; cursor: pointer; }
    #error { color: red; }
  </style>
</head>
<body>
  <h1>選擇電子書</h1>
  <div id="error"></div>
  <div id="book-list"></div>
  <div id="reader"></div>
  <script>
    // 檢查 epub.js 是否載入
    if (typeof ePub === "undefined") {
      document.getElementById("error").textContent = "錯誤：epub.js 未正確載入，請檢查網路或 CDN。";
    }

    // 手動定義 EPUB 清單（需先將檔案移到根目錄）
    const books = [
      "一條金線.epub"
      // 添加其他 EPUB，例如 "另一本書.epub"
    ];

    // 生成按鈕
    const bookList = document.getElementById("book-list");
    books.forEach(book => {
      const button = document.createElement("button");
      button.textContent = book;
      button.onclick = () => loadBook(book);
      bookList.appendChild(button);
    });

    // 載入並渲染 EPUB
    let currentBook;
    let currentRendition;
    function loadBook(bookPath) {
      if (typeof ePub === "undefined") {
        document.getElementById("error").textContent = "錯誤：epub.js 未載入，無法閱讀電子書。";
        return;
      }
      if (currentBook) {
        currentRendition.destroy();
        currentBook.destroy();
      }
      try {
        currentBook = ePub(bookPath);
        currentRendition = currentBook.renderTo("reader", {
          width: "100%",
          height: "100%",
          spread: "auto",
          allowScriptedContent: true
        });
        currentRendition.display().catch(err => {
          document.getElementById("error").textContent = `渲染錯誤：${err.message}`;
        });
      }
